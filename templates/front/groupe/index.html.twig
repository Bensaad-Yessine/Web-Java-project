{% extends 'user/FrontOffice.html.twig' %}

{% block title %}Gestion de Groupe - ESPRIT{% endblock %}

{% block body %}
<main class="main">
<header class="header">
    <div>
        <h1 class="h1">Gestion de Groupe</h1>
        <p class="muted">G√©rez vos groupes de projet et collaborez avec vos camarades</p>
    </div>
    <div class="session-display">
        <div>Total groupes</div>
        <div>{{ groupe_projets|length }}</div>
    </div>
</header>

<!-- Flash Messages -->
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label }}" style="margin-bottom: 20px; padding: 16px 20px; border-radius: 12px; background: {% if label == 'success' %}var(--green-50){% elseif label == 'error' %}var(--red-50){% else %}var(--blue-50){% endif %}; border: 1px solid {% if label == 'success' %}var(--green-200){% elseif label == 'error' %}var(--red-200){% else %}var(--blue-200){% endif %}; color: {% if label == 'success' %}var(--green-900){% elseif label == 'error' %}var(--red-900){% else %}var(--blue-900){% endif %};">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

<div class="profile-container">
    <!-- Toolbar -->
    <div style="margin-bottom: 32px; display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
        <input 
            type="text" 
            id="searchInput" 
            placeholder="üîç Rechercher un groupe..." 
            style="flex: 1; min-width: 250px; padding: 14px 20px; border: 1px solid var(--gray-200); border-radius: var(--radius-lg); font-size: 15px; transition: all var(--transition);"
            onkeyup="filterGroups()"
        >
        
        <select 
            id="sortBy" 
            onchange="sortGroups()" 
            style="padding: 14px 20px; border: 1px solid var(--gray-200); border-radius: var(--radius-lg); font-size: 15px; background: white; cursor: pointer; transition: all var(--transition);"
        >
            <option value="createdAt">Trier par date</option>
            <option value="id">Trier par ID</option>
            <option value="members">Trier par membres</option>
        </select>

        <a href="{{ path('front_groupe_projet_new') }}" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; background: linear-gradient(135deg, var(--red-500), var(--orange-500)); color: white; text-decoration: none; border-radius: var(--radius-lg); font-weight: 600; transition: all var(--transition); box-shadow: var(--shadow-sm);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Nouveau Groupe
        </a>
    </div>

    <!-- Groups Grid -->
    <div id="groupsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 24px;">
        {% for groupe in groupe_projets %}
            {% include 'front/groupe/_group_card.html.twig' with {'groupe': groupe} %}
        {% else %}
            <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--gray-300)" stroke-width="1.5" style="margin: 0 auto 20px;">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                <h3 style="font-size: 20px; color: var(--gray-600); margin-bottom: 8px;">Aucun groupe</h3>
                <p style="color: var(--gray-400); margin-bottom: 24px;">Vous ne faites partie d'aucun groupe pour le moment. Cr√©ez un groupe ou attendez qu'un autre membre vous y ajoute.</p>
                <a href="{{ path('front_groupe_projet_new') }}" class="btn btn-primary">Cr√©er un groupe</a>
            </div>
        {% endfor %}
    </div>
</div>
</main>

<script>
function filterGroups() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const cards = document.querySelectorAll('.group-card');
    
    cards.forEach(card => {
        const title = card.querySelector('.card-title').textContent.toLowerCase();
        if (title.includes(search)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function sortGroups() {
    const sortBy = document.getElementById('sortBy').value;
    const container = document.getElementById('groupsContainer');
    const cards = Array.from(container.querySelectorAll('.group-card'));
    
    cards.sort((a, b) => {
        let aVal, bVal;
        
        if (sortBy === 'id') {
            aVal = parseInt(a.dataset.id);
            bVal = parseInt(b.dataset.id);
        } else if (sortBy === 'members') {
            aVal = parseInt(a.dataset.members);
            bVal = parseInt(b.dataset.members);
        } else {
            aVal = new Date(a.dataset.created);
            bVal = new Date(b.dataset.created);
        }
        
        return bVal - aVal;
    });
    
    cards.forEach(card => container.appendChild(card));
}
</script>

<style>
.btn {
    display: inline-block;
    padding: 12px 24px;
    border-radius: var(--radius-lg);
    font-weight: 600;
    text-decoration: none;
    transition: all var(--transition);
    cursor: pointer;
    border: none;
    font-size: 15px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--red-500), var(--orange-500));
    color: white;
    box-shadow: var(--shadow-sm);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}
</style>
{% endblock %}
