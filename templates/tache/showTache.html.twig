{# templates/tache/showTache.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Liste des Tâches{% endblock %}

{% block body %}
<div class="main-panel">
  <div class="content-wrapper">

    <h1>Liste des Tâches</h1>

    {# Search + Date Filter Form with separate actions #}
    <div class="mb-3 d-flex gap-2 align-items-end">

        {# 1️⃣ Title search form #}
        <form method="get" action="{{ path('searchTache') }}" class="d-flex gap-2 align-items-end">
            <div class="d-flex flex-column">
                <label for="titre">Titre</label>
                <input type="text" id="titre" name="titre" placeholder="Titre..." value="{{ titre|default('') }}" class="form-control">
            </div>
            <div>
                <button type="submit" class="btn btn-primary mt-2">Rechercher</button>
            </div>
        </form>

        {# Date interval filter form with dd-mm-yyyy #}
        <form method="get" action="{{ path('filterTasks') }}" class="d-flex gap-2 align-items-end">
            <div class="d-flex flex-column">
                <label for="start">Date début</label>
                <input type="text" id="start" name="start" value="{{ start|default('') }}" class="form-control datepicker" placeholder="dd-mm-yyyy">
            </div>
            <div class="d-flex flex-column">
                <label for="end">Date fin</label>
                <input type="text" id="end" name="end" value="{{ end|default('') }}" class="form-control datepicker" placeholder="dd-mm-yyyy">
            </div>
            <div>
                <button type="submit" class="btn btn-primary mt-2">Filtrer</button>
            </div>
        </form>

    </div>


    {# Add Task Button #}
    <a href="{{ path('addTache') }}" class="btn btn-success mb-3">Ajouter une tâche</a>

    {# Tasks Table #}
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Titre</th>
                    <th>Type</th>
                    <th>Date Début</th>
                    <th>Date Fin</th>
                    <th>Durée</th>
                    <th>Priorité</th>
                    <th>Statut</th>
                    <th>Origine</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for tache in taches %}
                    <tr>
                        <td>{{ tache.id }}</td>
                        <td>{{ tache.titre }}</td>
                        <td>{{ tache.type }}</td>
                        <td>{{ tache.dateDebut ? tache.dateDebut|date('d/m/Y H:i') : '—' }}</td>
                        <td>{{ tache.dateFin ? tache.dateFin|date('d/m/Y H:i') : '—' }}</td>
                        <td>{{ tache.dureeEstimee }} min</td>
                        <td>{{ tache.priorite }}</td>
                        <td>{{ tache.statut }}</td>
                        <td>{{ tache.origine }}</td>
                        <td>
                            <a href="{{ path('editTache', {'id': tache.id}) }}" class="btn btn-sm btn-info">Modifier</a>
                            <form method="post" action="{{ path('deleteTache', {'id': tache.id}) }}" style="display:inline;">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ tache.id) }}">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Voulez-vous vraiment supprimer cette tâche ?');">
                                    Supprimer
                                </button>
                            </form>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="10">Aucune tâche trouvée</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

  </div>
</div>
{% endblock %}
